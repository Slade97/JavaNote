问题

```
如何实现一个热搜功能？ 给你一个包含一亿关键词的用户检索日志，如何取出排行前10的关键词
处理机器：2CPU 2G内存（很差，没得分布式）
```

Map分治+堆树



**完全二叉树**：除了最后一层，其他层每个节点都是满的且最后一层的节点都要靠左排列



堆是什么？

```
一颗完全二叉树
其每一个节点的值都大于等于或者小于等于其左右子节点的值
```

大顶堆：其每一个节点的值都大于等于其左右子节点的值

小顶堆：其每一个节点的值都小于等于其左右子节点的值

和完全二叉树一样，存数组效率比链表更好

存数组的时候左右节点的公式：

（注意：此时数组0下标没存节点 ）

左节点的下标=2*i i是当前节点的下标

右节点的下标=2*i+1

**插入；** 从下往上 从上往下 

其插入过程就叫做**堆化**：

从下往上，如果插入以后不满足性质，做下交换就可以了，一直往上交换，直到满足

完全二叉树，类似于满二叉树，32层可以存21亿+个点，n个数交换多少次logn-1次

**删除：**

堆顶删除，然后从下往上堆化就行了

### 堆排序

给一个序列，做成堆：

```
8 4 20 7 3 1 25 14 17
```

比如小顶堆。每次做一个小顶堆，然后把root和数组最后一个元素交换并把root拿出去，

剩下的节点继续做堆化，构成一个新的小顶堆堆，重复以上步骤。

我们就得到了一个升序排序序列



回到之前的问题：

```
如何实现一个热搜功能？ 给你一个包含一亿关键词的用户检索日志，如何取出排行前10的关键词
处理机器：2CPU 2G内存（很差）
```

**哈希散链表给关键词计数**

https://baike.baidu.com/item/Hash/390310?fr=aladdin

放到硬盘，分治，分成很多份，1亿分成10份，分布式，分库分表，我要直到我的数据在哪张表，hash%分表数

```
hash%10=当前这个词放在哪个文件
```

分成10个文件后，分别求top10，然后把这top10合起来，也就是有100个数，再来一次。

MapReduce的思想，但是使用MapReduce需要hadoop成本高



堆的应用：

优先级队列

TOP K问题，比如给你一串1000万的数字，求前k大的数

一种是静态的数据

一种是动态的数据

```
TOP 大问题
弄10个小顶堆存这些数据，然后新加进来的数，和堆顶元素比较，若小于堆顶元素，则舍弃，若大于，则删除堆顶元素，添加新增原色，并进行堆化  o[n]

Top小问题解决思路：使用一个固定大小的最大堆，当堆满后，每次添加数据到时候与堆顶元素进行比较，若大于堆顶元素，则舍弃，若小于堆顶元素，则删除堆顶元素，添加新增元素，对堆进行重新排序。
https://www.cnblogs.com/liuyang0/p/6710137.html
```

